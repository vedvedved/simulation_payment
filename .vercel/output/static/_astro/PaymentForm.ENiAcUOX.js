import{d as ie,c as p,b as ae,g as m,a as f,i as a,e as $,f as x,r as se,t as P,s as _,S as h}from"./web.Bw1n2RBh.js";function ce(r){const e=r.replace(/\D/g,"");let i=0,d=!1;for(let s=e.length-1;s>=0;s--){let u=parseInt(e.charAt(s),10);d&&(u*=2,u>9&&(u-=9)),i+=u,d=!d}return!!e&&i%10===0}function oe(r){return r.replace(/\D/g,"").slice(0,19).replace(/(.{4})/g,"$1 ").trim()}function ue(r){const e=r.replace(/\D/g,"").slice(0,4);return e.length<=2?e:e.slice(0,2)+"/"+e.slice(2)}function de(r){const e=r.replace(/\D/g,"");return e.length>=4?`•••• •••• •••• ${e.slice(-4)}`:"••••"}function ge(r){return!r||!r.trim()?"Name required":r.trim().length<2?"Use full name":""}function pe(r){const e=r.replace(/\D/g,"");return/^\d{13,19}$/.test(e)?ce(e)?"":"Invalid card number":"Card must be 13–19 digits"}function me(r){const e=r.replace(/\D/g,"");if(!/^\d{4}$/.test(e))return"Expiry must be MM/YY";const i=Number(e.slice(0,2)),d=Number(e.slice(2,4));if(i<1||i>12)return"Invalid month";const s=new Date,u=Number(String(s.getFullYear()).slice(2)),v=s.getMonth()+1;return d<u||d===u&&i<v?"Card expired":""}function ve(r){const e=r.replace(/\D/g,"");return/^\d{3,4}$/.test(e)?"":"CVV must be 3 or 4 digits"}var y=P("<div class=error role=alert>"),be=P('<form class=form novalidate><div class=form-row><label class=form-label>Name on card</label><input class="input large-input"placeholder="Full name"autocomplete=cc-name><!$><!/></div><div class=form-row><label class=form-label>Card number</label><input class="input large-input"inputmode=numeric placeholder="1234 5678 9012 3456"autocomplete=cc-number><!$><!/></div><div class=form-grid><div><label class=form-label>Expiry (MM/YY)</label><input class=input inputmode=numeric placeholder=MM/YY autocomplete=cc-exp><!$><!/></div><div><label class=form-label>CVV</label><input class=input type=password inputmode=numeric placeholder=*** maxlength=4 autocomplete=cc-csc><!$><!/></div></div><div class=form-actions><button class="btn pay large"type=submit></button></div><!$><!/>');function $e(){const[r,e]=p(""),[i,d]=p(""),[s,u]=p(""),[v,V]=p(""),[D,M]=p(!1),[c,b]=p({name:"",card:"",expiry:"",cvv:"",global:""}),I=ae(()=>{const n=ge(r()),l=pe(i()),o=me(s()),g=ve(v());return b({name:n,card:l,expiry:o,cvv:g,global:""}),!n&&!l&&!o&&!g}),j=n=>d(oe(n)),L=n=>u(ue(n)),O=n=>V(n.replace(/\D/g,"").slice(0,4)),R=async n=>{if(n.preventDefault(),!I()){b(l=>({...l,global:"Fix errors above before paying."}));return}b(l=>({...l,global:""})),M(!0);try{const l=await fetch("/api/payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r().trim(),card:i().replace(/\s+/g,""),maskedCard:de(i()),expiry:s(),cvv:v(),amount:"₹499.00"})}),o=await l.json();l.ok&&o.id?location.href=`/receipt?tx=${encodeURIComponent(o.id)}`:b(g=>({...g,global:o?.error||"Server error"}))}catch{b(o=>({...o,global:"Network error"}))}finally{M(!1)}};return(()=>{var n=m(be),l=n.firstChild,o=l.firstChild,g=o.nextSibling,U=g.nextSibling,[q,A]=f(U.nextSibling),C=l.nextSibling,H=C.firstChild,S=H.nextSibling,J=S.nextSibling,[z,B]=f(J.nextSibling),Y=C.nextSibling,w=Y.firstChild,G=w.firstChild,E=G.nextSibling,K=E.nextSibling,[Q,W]=f(K.nextSibling),k=w.nextSibling,X=k.firstChild,N=X.nextSibling,Z=N.nextSibling,[ee,te]=f(Z.nextSibling),T=Y.nextSibling,F=T.firstChild,re=T.nextSibling,[ne,le]=f(re.nextSibling);return n.addEventListener("submit",R),g.$$input=t=>e(t.currentTarget.value),a(l,$(h,{get when(){return c().name},get children(){var t=m(y);return a(t,()=>c().name),t}}),q,A),S.$$input=t=>j(t.currentTarget.value),a(C,$(h,{get when(){return c().card},get children(){var t=m(y);return a(t,()=>c().card),t}}),z,B),E.$$input=t=>L(t.currentTarget.value),a(w,$(h,{get when(){return c().expiry},get children(){var t=m(y);return a(t,()=>c().expiry),t}}),Q,W),N.$$input=t=>O(t.currentTarget.value),a(k,$(h,{get when(){return c().cvv},get children(){var t=m(y);return a(t,()=>c().cvv),t}}),ee,te),a(F,()=>D()?"Processing...":"Pay ₹499"),a(n,$(h,{get when(){return c().global},get children(){var t=m(y);return a(t,()=>c().global),t}}),ne,le),x(()=>_(F,"disabled",!I()||D())),x(()=>_(g,"value",r())),x(()=>_(S,"value",i())),x(()=>_(E,"value",s())),x(()=>_(N,"value",v())),se(),n})()}ie(["input"]);export{$e as default};
